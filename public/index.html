<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>json-server example</title>
  <style>
    body{font-family:system-ui,Arial;max-width:800px;margin:2rem auto;padding:0 1rem}
    pre{background:#f5f5f5;padding:1rem;border-radius:6px;overflow:auto}
    button{margin-top:.5rem}
  </style>
</head>
<body>
  <h1>json-server demo</h1>
  <p>This page is served from <code>/public</code> and calls the json-server API on the same origin.</p>

  <section id="posts">Loading posts…</section>

  <h2>Create a post</h2>
  <input id="title" placeholder="Title" style="width:100%;margin-bottom:.5rem"/>
  <textarea id="body" placeholder="Body" style="width:100%;height:80px"></textarea>
  <br/>
  <button id="create">Create</button>

  <h3>Raw db.json</h3>
  <pre id="raw">Loading…</pre>

  <script>
    const api = (path, opts) => fetch(path, opts).then(r => {
      if (!r.ok) throw new Error(r.status + ' ' + r.statusText);
      return r.json();
    });

    async function load() {
      try {
        const posts = await api('/posts');
        document.getElementById('posts').innerHTML = posts.map(p => 
          `<article><h3>${escape(p.title)}</h3><p>${escape(p.body)}</p></article>`
        ).join('') || '<em>No posts</em>';

        const raw = await api('/'); // json-server returns db object at /
        document.getElementById('raw').textContent = JSON.stringify(raw, null, 2);
      } catch (err) {
        document.getElementById('posts').textContent = 'Error: ' + err;
        document.getElementById('raw').textContent = '';
      }
    }

    document.getElementById('create').addEventListener('click', async () => {
      const title = document.getElementById('title').value.trim();
      const body = document.getElementById('body').value.trim();
      if (!title || !body) return alert('fill title + body');
      try {
        await api('/posts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, body })
        });
        document.getElementById('title').value = '';
        document.getElementById('body').value = '';
        load();
      } catch (err) {
        alert('Create failed: ' + err);
      }
    });

    function escape(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    load();
  </script>
</body>
</html>
